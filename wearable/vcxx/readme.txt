
/*


//================================================
V1.9.9 2022-03-29
修改文件[vcHr02Hci.c][vcHr02Hci.h]
1. V1.99，根据设计需求，参考10_11系列的电容减少，修改对应的配置，将环境光，滤波及发光时间减半，增加一倍过采。可实现功耗性能相当，成本减少的目的。兼容之前的驱动，用宏配置去实现。
#define HW_HALVE_POWER_CAP 1 //sample config param halve & oversample double
2.时钟校验处添加防止除数为0的代码：diffCountIsOk = (!(intDiffRtc[2 * i + 2] == intDiffRtc[2 * i]))&&diffCountIsOk;	/* avoid divisor==0, diffCountIsOk set false */





//================================================
V1.3_2020-08-27
vcHR02系列芯片可使用两种不同的工作方式:

*默认且推荐纯中断方式*

1.纯中断方式：demo使用例程见module_heart_vc_int.c
 a、FIFO中断及PS中断信号作为时间信号，佩戴状态以FIFO中断为准，摘下状态以ps中断为准，可以配置成所需要的中断时间间隔，
    GsensorFIFO读取放在该中断下，保证gsensor数据获取；同样由于Gsensor与心率工作频率不同，需要进行数据匹配；
 b、其余中断信号作为调整等标志，不读取Gsensor数据；

2.定时器方式：demo使用例程见module_heart_vc_time.c
 a、定时器中断到来之后读取GsensorFIFO及心率芯片FIFO，由于Gsensor与心率工作频率不同，需要进行数据匹配；
 b、同时仍需要外部中断接口，相应外部中断进行芯片内部工作调整；



//================================================
V1.4_2020-09-16
添加桌面识别逻辑 
1.算法输出-1，算法重新初始化，心率进入摘下模式；
2.重新进入佩戴引入Gsensor参量；



//================================================
V1.5_2020-10-20
添加漏光检测



//================================================	
V1.6_2020-11-09	
1.添加Gsensor数据匹配逻辑；
2.整合逻辑，优化驱动，增加可读性；
*/V1.7_2020-11-21	1.修改ADC时钟：降频至1M。2.以800ms的红外中断情况下修改红外摘下到佩戴psflag出现的1600ms的问题 3。增加强阳光下不佩戴上的逻辑；4.修改31B52S、52T红外摘下阈值



//================================================	
V1.8_2020-11-25	
1.增加运动模式；

//================================================	
V1.9.1 2020-12-1
1.增加由于系统响应不及时，在fifo没有存入数据的情况下进入fifo数据读取函数从而导致的datelength返回64的问题，解决为：出现datelength为64时，将datelength清零，并清楚fiforeadflag；
2.修改时钟校验的rtc_th阈值（修改为：以800ms为例，最大可容纳时钟偏差2*oscDfSetting (oscDfSetting  = 10 ) 2‰，rtc_th = 800ms*2‰ =1600us; rtc_th = 32000(mcuosc)*1600us/1000000 = 52)
3.在复位程序中清除未佩戴到佩戴模式下的初次校验标志位lastAdjRecordValid


//================================================
V1.9.2 2020-12-15 
1.修改V1.9.1版本的时钟校验部分（1.9.1版本时钟校验仅适用于fifo为800ms）采取新的3次进入fifo中获取rtc值，两两相减小于oscDifSetting（现oscDifSetting阈值为2，可根据实际情况进行放缩），3次校验后获取两次分频寄存器值，小于理论值时则进行分频数修订。
2.增加52S、32S、以及9201宏在摘下时屏蔽由于不可测所导致的摘下标志位（slot0EnvIsExceedFlag和slot1EnvIsExceedFlag）
3.增加测试模式下读取红外值，开启solt2通道。4.由于一线需求，增加LPDETECTION模式（LowPowerDetection），仅使能slot2红外中断，开启佩戴检查返回佩戴状态佩戴，每次中断都将psflag置为1。

//================================================
V1.9.2.2 2021-03-15
1.设定血氧模式下，ps和采样频率一致。采用Fifo中断做为检测摘下的条件，摘下后打开ps中断并设定为与Fifo中断同频。
//================================================
V1.9.2.3 2021-03-15
1.针对VC31B打开hs存在基础偏移值的问题，增加psBias和psBiasReadInPdFlag两个变量。在初设化后先打开ps通道收集使用内部pd读回的ps值除以2作为psBias的基础值。并将psBiasReadInPdFlag置为1。   
pvcHr02->sampleData.psValue = pvcHr02->sampleData.psValue - psBias作为新的psvalue。 获取基础偏移值（psBias）仅有一次，摘下复位后也不会更新此值。

//================================================
V1.9.5 2021-11-01
漏光模式增加红灯闪烁。
漏光测试最新流程：
1.将手表开窗部分放在在硅胶块上，I_max>=100&pre<3.满足结构装配合格。
2.红外测试：在玻璃片上测试，I_max>=100&ps>12.满足红外LED正常。
3.红灯测试：最后看红灯是否发光，判断红灯是否虚焊或短接。

//================================================
V1.9.6 2021-11-15
删除饱和摘下逻辑，运动模式确认为AlgoSportMode_t

//================================================
V1.9.8 2022-03-29
修改文件[vcHr02Hci.c][vcHr02Hci.h]
增加宏开关VCHR02ISVP60A1，VCHR02ISVP60A2，具体PS阈值与电流，60A1=32S，60A2=52S。