# building script for HoneyGUI

from building import *
import os
import menu_config

cwd = GetCurrentDir()
CPPPATH = [cwd]
CPPPATH += [cwd + '\\root_image']

objs = []
CPPDEFINES = []
src = []

# Effect files: depend on particle system core
if GetDepend('CONFIG_REALTEK_BUILD_PARTICLE_SYSTEM'):
    src += [os.path.join(cwd, f) for f in os.listdir(cwd)
            if f.startswith('effect_') and f.endswith('.c')]

# Demo, launcher, example: depend on particle demo selection
if GetDepend('CONFIG_REALTEK_BUILD_PARTICLE_DEMO'):
    CPPDEFINES = ['DRV_LCD_WIDTH=410']
    CPPDEFINES += ['DRV_LCD_HEIGHT=502']
    CPPDEFINES += ['DRV_PIXEL_BITS=16']
    src += [os.path.join(cwd, f) for f in [
        'particle_demo.c',
        'particle_launcher.c',
        'example_particle.c',
    ]]

    if hasattr(menu_config, 'ARCH') and menu_config.ARCH == 'win32':
        from honeygui import *

        print("Target arch is win32, attempting to add prebuilt binary object...")
        BIN_SUBDIR = os.path.join(cwd, 'root_image')
        BIN_FILE = os.path.join(BIN_SUBDIR, 'root_0x704D1400.bin')
        OBJ_FILE = os.path.join(BIN_SUBDIR, 'root_0x704D1400_bin.o')
        result_node = add_prebuilt_binary_object(BIN_FILE, OBJ_FILE)
        if result_node:
            additional_objs = []
            additional_objs.append(result_node)
            print(additional_objs)
            src = Flatten(src + additional_objs)

objs = DefineGroup('realgui/demo', src, depend = [''], CPPPATH = CPPPATH, CPPDEFINES = CPPDEFINES)

Return('objs')
