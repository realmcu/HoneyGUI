import os

# Emoji 等级字典 https://home.unicode.org/emoji/emoji-frequency/
emoji_levels = {
    0: ['😂', '❤️'],
    1: ['😍', '🤣'],
    2: ['😊', '🙏', '💕', '😭', '😘'],
    3: ['👍', '😅', '👏', '😁', '♥️', '🔥', '💔', '💖', '💙', '😢', '🤔', '😆', '🙄', '💪', '😉', '☺️', '👌', '🤗'],
    4: ['💜', '😔', '😎', '😇', '🌹', '🤦', '🎉', '‼️', '💞', '✌️', '✨', '🤷', '😱', '😌', '🌸', '🙌', '😋', '💗', '💚',
        '😏', '💛', '🙂', '💓', '🤩', '😄', '😀', '🖤', '😃', '💯', '🙈', '👇', '🎶', '😒', '🤭', '❣️'],
    5: ['❗', '😜', '💋', '👀', '😪', '😑', '💥', '🙋', '😞', '😩', '😡', '🤪', '👊', '☀️', '😥', '🤤', '👉', '💃', '😳',
        '✋', '😚', '😝', '😴', '🌟', '😬', '🙃', '🍀', '🌷', '😻', '😓', '⭐', '✅', '🌈', '😈', '🤘'],
    6: ['💦', '✔️', '😣', '🏃', '💐', '☹️', '🎊', '💘', '😠', '☝️', '😕', '🌺', '🎂', '🌻', '😐', '🖕', '💝', '🙊',
        '😹', '🗣️', '💫', '💀', '👑', '🎵', '🤞', '😛', '🔴', '😤', '🌼', '😫', '⚽', '🤙', '☕', '🏆', '🧡', '🎁',
        '⚡', '🌞', '🎈', '❌', '✊', '👋', '😲', '🌿', '🤫', '👈', '😮', '🙆', '🍻', '🍃', '🐶', '💁', '😰', '🤨',
        '😶', '🤝', '🚶', '💰', '🍓', '💢'],
    7: ['🇺🇸', '🤟', '🙁', '🚨', '💨', '🤬', '✈️', '🎀', '🍺', '🤓', '😙', '💟', '🌱', '😖', '👶', '▶️', '➡️', '❓',
        '💎', '💸', '⬇️', '😨', '🌚', '🦋', '😷', '🕺', '⚠️', '🙅', '😟', '😵', '👎', '🤲', '🤠', '🤧', '📌', '🔵',
        '💅', '🧐', '🐾', '🍒', '😗', '🤑', '🚀', '🌊', '🤯', '🐷', '☎️', '💧', '😯', '💆', '👆', '🎤', '🙇', '🍑',
        '❄️', '🌴', '🇧🇷', '💣', '🐸', '💌', '📍', '🥀', '🤢', '👅', '💡', '💩', '⁉️', '👐', '📸', '👻', '🤐',
        '🤮', '🎼', '✍️', '🚩', '🍎', '🍊', '👼', '💍', '📣', '🥂', '⤵️', '📱', '☔', '🌙'],
    8: ['🍾', '🎧', '🍁', '⭕', '🏀', '☠️', '⚫', '🖐️', '😧', '🎯', '📲', '☘️', '👁️', '🍷', '👄', '🐟', '🍰', '💤',
        '🕊️', '📺', '💭', '🐱', '🐝', '🇲🇽', '🧚', '🔝', '📢', '📷', '🐕', '🎸', '🔫', '🤚', '🍭', '🍆', '💉', '🌎',
        '😦', '🌀', '👿', '☑️', '🎥', '🌧️', '👽', '🍋', '🤒', '🤡', '🍫', '📚', '🏁', '🤕', '🦄', '🍅', '🚗', '🚫',
        '💵', '⚾', '🔪', '🔔', '♨️', '🌳', '🔊', '🍬', '💏', '🍼', '🍜', '🐼', '🙉', '🐈', '🐻', '🤸', '🌝', '👸',
        '🍕', '🍌', '🍦', '⚪', '👩', '😿', '🍂', '📞', '⏰', '🔞', '🌍', '🌠', '🙀', '▪️', '☁️', '👹', '🍉', '🐥',
        '🌶️', '1️⃣', '🌵', '🇮🇳', '👧', '🍄', '👮', '💮', '🐰', '🔷', '🌾', '🔹', '🇹🇷', '🥇', '🇮🇹'],
    9: ['🍪', '🇦🇷', '🛑', '🐍', '🎓', '🇨🇦', '🍏', '🦁', '😽', '🚬', '🍖', '🍴', '🆘', '🤜', '🍿', '🍔', '📝', '🇯🇵',
        '🍮', '🍇', '2️⃣', '🏠', '🤰', '🐣', '🐒', '👦', '🍩', '🍣', '🤛', '👯', '🏳️‍🌈', '♠️', '🌲', '🐴', '🍛',
        '🎆', '💑', '🍞', '🍯', '☄️', '😸', '🍚', '🎬', '🎙️', '🇨🇴', '🐳', '🦀', '🥃', '🔸', '💊', '🐎', '🍹', '♦️',
        '🔮', '👨', '🍸', '🌏', '👴', '🧢', '🐽', '🐔', '🎻', '⬆️', '✂️', '👫', '👣', '🐯', '🎮', '🍵', '🐦', '🇬🇧',
        '〰️', '👭', '🐬', '🍟', '👙', '✖️', '📩', '👵', '🍨', '🇫🇷', '🐖', '✝️', '♻️', '🥊', '🦅', '💬', '🇨🇱',
        '🐢', '🔰', '🔶', '🎗️', '💄', '👠', '🥕', '➖', '🐺', '📖', '🍍', '🌃', '✴️', '🌌', '🐓', '👂', '🍤', '🐐',
        '🔻', '💻', '🦐', '🇩🇪', '🌛', '↘️', '✏️', '🧘', '🥁', '🏖️', '⚜️', '❕', '🅰️', '🚴', '💠', '㊗️', '🐙',
        '♣️', '🍡', '⏩', '🎨', '🐠', '🇰🇷', '🍗', '🚮', '▫️', '🌪️', '😼', '👤', '🏊', '🌽', '🎩', '🇪🇸', '🎹',
        '🍈', '◀️', '↔️', '🏡', '🇵🇰', '🎇', '🥩', '🐞', '3️⃣', '⬅️', '🌐', '↗️', '🍽️', '🧀', '🥦', '🐜', '⚔️'],
    10: ['😺', '🥞', '🏄', '🔨', '🏝️', '🔆', '👥', '👓', '🥒', '🏈', '🇵🇭', '🏋️', '0️⃣', '🚘', '🦖', '🌕', '🎭', '👾',
         '🍳', '🏵️', '🍧', '🔗', '🕋', '☃️', '🌅', '🤴', '🖖', '🐊', '🐘', '🌤️', '🥑', '🥚', '⛈️', '🐵', '🔜',
         '🍶', '🐄', '🇻🇪', '🐮', '🦈', '🚲', '⛔', '🕯️', '➕', '🔺', '💇', '🧠', '📻', '🥤', '🍝', '🍥', '💴', '🌬️',
         '🥓', '🙍', '⚓', '👰', '🐂', '📽️', '🏅', '⛅', '🇦🇪', '🇵🇪', '🧜', '📮', '⛳', '🔽', '🚂', '🏌️', '🐇',
         '🏍️', '🎲', '🥛', '🎣', '👱', '🎏', '🕷️', '🦍', '🔘', '🐅', '🏇', '🔐', '🏩', '👺', '🅱️', '🚙', '🐧',
         '⚖️', '🎃', '🌄', '🎾', '🐚', '🎺', '❇️', '🎫', '⌚', '🌋', '💒', '👳', '❎', '👟', '👃', '🛌', '🚓',
         '⏬', '📈', '⛄', '⏱️', '😾', '🛫', '🤱', '🍐', '☮️', '🚃', '⏳', '🌜', '📹', '🐛', '👔', '👗', '🐌', '🎱',
         '🌰', '🌮', '🕵️', '🔅', '✉️', '🇪🇬', '🚑', '📦', '🤥', '🔄', '🤳', '💲', '🎋', '🗓️', '🤖', '🥔', '🆗', '🔑',
         '🇨🇳', '🐤', '4️⃣', '🐑', '➰', '👩‍🎓', '☂️', '🇦🇹', '🦆', '🚌', '💿', '🏥', '🐋', '🚒', '🏐', '🇪🇨', '🥐',
         '🎷', '🗽', '🗡️', '🏏', '🐭', '🙎', '🌑', '🚔', '🇮🇩', '🚿', '🥝', '🕌', '🐀', '🛡️', '🔒', '✳️', '🕶️',
         '👩‍❤️‍💋‍👩', '🎟️', '🐉', '🔱', '🔎', '🇦🇺', '⚰️', '🐩', '🦑', '🧟', '🆕', '🦊', '👕', '🏹', '🇩🇿', '👬',
         '🍱', '📰', '🥋', '🚤', '🏰', '5️⃣', '🦉', '🚢', '🌨️', '📆', '🗝️', '🎌', '🧔', '💳', '🇺🇾', '🥗', '☯️',
         '⚙️', '💶', '⛩️', '🗻', '✒️', '🇺🇲', '🇵🇹', '🍠'],
    11: ['👷', '🛍️', '🏎️', '🔛', '🔙', '🗼', '🎖️', '🚺', '🐹', '🥖', '🇵🇷', '🎡', '🔍', '🏟️', '🖥️', '🌭', '🇹🇭',
         '✡️', '🏒', '🛀', '📅', '🖋️', '🇸🇪', '🎞️', '🎪', '🍙', '🛁', '📕', '👒', '🖇️', '❔', '🎄', '🕸️', '🥜', '🕴️',
         '🥟', '↙️', '◾', '🐲', '🏴', '🦌', '🆔', '👛', '🚚', '↪️', '🇬🇷', '📿', '🌫️', '🌂', '🕉️', '🆚', '📉',
         '🗨️', '🛒', '📛', '🇳🇱', '🐿️', '🅾️', '☢️', '🇲🇦', '🐃', '⛽', '🅿️', '🦇', '⤴️', '⛵', '👞', '🔓', '🧞',
         '⛰️', '📎', '🦎', '🔌', '🏳️', '🚽', '🍲', '⚒️', '♊', '👢', '🧙', '🇵🇱', '⛪', '🇧🇪', '🎎', '🔖', '🔋', '📡',
         '🌇', '🏉', '👪', '👖', '📊', '🐆', '🔁', '🛩️', '🐡', '🃏', '👩‍💻', '🌩️', '🇳🇬', '🐏', '6️⃣', '⛹️', '🗯️',
         '🇨🇭', '🍢', '🗺️', '🚕', '🇷🇺', 'Ⓜ️', '⛱️', '🏫', '📀', '🆙', '🤼', '🐨', '🦂', '💷', '🥈', '👨‍💻', '🛏️',
         '◼️', '🚄', '🧖', '🎠', '🐁', '🗳️', '🏮', '🥪', '🌥️', '🚪', '㊙️', '🗞️', '👨‍⚕️', '🖊️', '⬛', '🆒', '🇨🇺',
         '🥧', '👩‍⚕️', '🇳🇮', '👨‍🎓', '🚧', '⛓️', '🛵', '🥅', '🚅', '🖼️', '♿', '📏', '🀄', '🖌️', '🉐', '📬', '🚁',
         '🗑️', '🤵', '🏷️', '🌡️', '🎐', '🇯🇲', '🦒', '🎒', '🇵🇾', '🇺🇦', '🇲🇨', '🥉', '7️⃣', '⌛', '🌒', '🥥', '🎅',
         '🧕', '🛐', '♋', '🧑', '🇩🇴', '🇮🇪', '🛸', '🧒', '📧', '🥢', '🎢', '🐪', '🇮🇱', '👨‍🍳', '🚛', '🥄', '🤹',
         '🏢', '💈', '👘', '🇳🇴', '🇬🇭', '🏔️', '〽️', '🚦', '🇿🇦', '🇹🇳', '💼', '♈', '🦓', '🚻', '🎰', '◽', '🦗',
         '🤾', '👚', '👡', '⛏️', '9️⃣', '🛎️', '🐗', '🌦️', '🇸🇦', '🚹', '🇾🇪', '☪️', '🤺', '🚣', '🗿', '🥘', '🇩🇰',
         '🦕', '🇱🇷', '🏕️', '☣️', '🌆', '↕️', '📨', '🏨', '🕹️', '👩‍🍳', '🇨🇮'],
    12: ['📯', '👜', '🏘️', '🐫', '⛺', '👩‍🏫', '🕳️', '🏯', '🌓', '🌉', '8️⃣', '💂', '🔉', '👨‍👩‍👧‍👦', '🇪🇺', '🚜',
         '🔕', '📥', '🌔', '🏙️', '🥨', '🇲🇾', '📘', '📗', '📜', '♏', '🇧🇴', '🏜️', '🍘', '🛬', '🌯', '🏗️', '🏴', '🚼',
         '🏞️', '🔈', '🕰️', '🏓', '🇨🇷', '👨‍🌾', '🦃', '🔦', '🔃', '🇸🇻', '🛳️', '🌘', '🇧🇩', '🧛', '👩‍❤️‍💩‍', '🔚',
         '🔟', 'ℹ️', '🛢️', '🏴', '🇸🇩', '🔭', '🇮🇶', '🎍', '🥣', '🌗', '↖️', '🎳', '👨‍❤️‍💋‍👨', '👨‍🏫', '📄', '🇶🇦',
         '👨‍👩‍👧', '🎚️', '🛠️', '🆓', '🇵🇸', '🏛️', '♐', '🧦', '🗾', '👩‍🌾', '🎑', '🇬🇹', '🧤', '🧝', '➿', '🇻🇳',
         '📒', '♉', '♓', '🚭', '🔧', '♌', '↩️', '♒', '🏦', '🈵', '🥫', '🌖', '🛴', '🚖', '🥙', '🛰️', '🦏', '🇸🇬',
         '⏺️', '🖍️', '⛸️', '📙', '👲', '🏂', '*️⃣', '🔲', '🇭🇺', '🚐', '👨‍❤️‍👨', '🔇', '🦔', '🔯', '🚵', '🚯', '🕛',
         '📼', '🧓', '🎛️', '🇨🇿', '🇭🇰', '💺', '👩‍🎤', '⛲', '⚛️', '🕒', '📶', '🚋', '🇱🇧', '📠', '🚇', '⏲️', '⏪',
         '🇰🇼', '🛃', '🇭🇳', '👨‍✈️', '📓', '👩‍👧', '♎', '🏑', '📋', '🔼', '🇨🇵', '🇯🇴', '📃', '🔬', '🇫🇮', '🚥',
         '🇱🇰', '♍', '🇵🇦', '🇸🇾', '🚾', '🇭🇷', '🇳🇿', '🚍', '🏸', '🔳', '🛂', '📵', '⛑️', '🏚️', '🎽', '🚰', '🏪',
         '⛷️', '👩‍💼', '♑', '🇨🇲', '🇱🇾', '⏫', '🏣', '🚉', '🛅', '⚕️', '⛴️', '👁️‍🗨️', '🏧', '◻️', '👩‍🔬', '⏹️',
         '🇷🇴', '👩‍👦', '⬜'],
    13: ['#️⃣', '🇦🇱', '🇹🇼', '🛣️', '🏤', '🛄', '🇮🇸', '🏬', '👨‍🎤', '🕐', '🎦', '👨‍💼', '💹', '☸️', '📵', '📐',
         '🖱️', '🇭🇹', '🇸🇳', '🔩', '🈲', '🎴', '📳', '☦️', '🚆', '📁', '📔', '🇦🇫', '👩‍🎨', '🕑', '🚸', '🧣', '👨‍🚀',
         '🇧🇭', '🏭', '🏺', '🇬🇳', '🤽', '🛥️', '🇲🇱', '🌁', '🤶', '🇦🇿', '💽', '🇦🇴', '🚎', '🇮🇷', '🇳🇵', '🗒️',
         '🇨🇩', '🛋️', '⌨️', '🆎', '🧗', '🧥', '🇰🇪', '🛶', '📑', '👝', '🇦🇲', '⏯️', '🇬🇪', '💱', '👨‍🎨', '🇧🇬',
         '🇪🇦', '👩‍⚖️', '🕓', '👩‍🚀', '🚞', '👨‍🚒', '🆖', '🔀', '👨‍🔬', '👨‍⚖️', '👨‍👩‍👦‍👦', '🏴', '🥠', '🚳',
         '🇧🇯', '🇲🇬', '🇪🇪', '⏭️', '🕎', '🈚', '🚡', '🕕', '🇷🇸', '🉑', '📂', '🇹🇿', '📫', '🕘', '🚊', '🚈', '🔂',
         '➗', '🕗', '👨‍👩‍👧‍👧', '🈹', '🇱🇺', '🛤️', '🇺🇬', '🕖', '🈴', '👨‍🔧', '🔏', '🇧🇼', '🚷', '🇲🇰', '🇱🇻',
         '🕙', '🇹🇹', '🇱🇹', '👩‍❤️‍💋‍👨', '👨‍👧', '📟', '👩‍✈️', '⏸️', '👩‍🚒', '🇿🇼', '🥡', '🇸🇰', '🕔'],
    14: ['🇴🇲', '💾', '📤', '⚗️', '🔠', '🚝', '🆑', '🇲🇲', '👨‍👦', '🇲🇹', '🕚', '🇧🇦', '👩‍👧‍👦', '🎿', '🔤', '🈶',
         '🚱', '🚏', '🇳🇪', '👩‍🔧', '🇧🇸', '🕍', '🇰🇭', '🔢', '🇨🇾', '📭', '📪', '🈳', '🇲🇷', '👩‍❤️‍💨', '👩‍👩‍👧',
         '🇰🇿', '🖨️', '⏮️', '🇬🇾', '🇸🇮', '🇧🇾', '🇸🇴', '🕠', '🇦🇼', '🖲️', '⚱️', '🇲🇪', '🇿🇲', '🇧🇧', '🇹🇯',
         '🇨🇬', '🇺🇿', '🇸🇱', '🇳🇦', '🚟', '🇧🇮', '🇽🇰', '🇦🇮', '🇪🇹', '👩‍👩‍👧‍👧', '🇦🇬', '👨‍🏭', '👩‍👧‍👧',
         '👨‍👨‍👧‍👧', '🈯', '🚠', '🕟', '👨‍👨‍👦‍👦', '👩‍👩‍👧‍👦', '🇷🇼', '🇦🇽', '👩‍👦‍👦', '🇫🇯', '🥌', '🇦🇸',
         '🇹🇩', '👨‍👧‍👦', '🇦🇩', '🇬🇲', '🇬🇦', '🗂️', '🇧🇲', '👩‍🏭'],
    15: ['🕝', '🕦', '🕢', '🕜', '🇲🇳', '🇹🇬', '🕤', '🇲🇿', '👨‍👨‍👦', '🈂️', '🇬🇼', '🇧🇳', '🇲🇻', '🕧', '🇲🇴', '🕡',
         '⛎', '🇹🇴', '🕣', '👨‍👨‍👧‍👦', '🇪🇷', '🇦🇨', '🇰🇬', '🇦🇶', '🇨🇻', '🇧🇫', '🇰🇵', '👨‍👦‍👦', '🕥', '🇲🇩',
         '🇮🇨', '🇻🇦', '🇬🇩', '🇮🇲', '👩 ‍👩‍👦‍👦', '🇲🇫', '📇', '🈺', '🇱🇦', '🛷', '🕞', '🇲🇼', '👩‍👩‍👦', '👨‍👨‍👧',
         '🈷️', '👨‍👧‍👧', '🇺🇳', '🗃️', '🇱🇸', '🗜️', '🇬🇺', '🇧🇻', '🔡', '🇫🇴', '🇲🇺', '🇵🇬', '🇨🇼', '🇬🇬', '🈁',
         '🔣', '🇼🇸', '🇸🇷', '🇹🇲', '🇸🇸', '🗄️', '🇧🇹', '🇸🇽', '🇰🇲', '🈸', '🇩🇲', '🇪🇭', '🇧🇿', '🇻🇮', '🇬🇫',
         '🇸🇲', '🇩🇯', '🇹🇨'],
    16: ['🇱🇨', '🇻🇺', '🇵🇫', '🇬🇮', '🇸🇨', '🇰🇳', '🇯🇪', '🇲🇶', '👨‍👩‍👦', '🇷🇪', '🇸🇿', '🇰🇾', '⏏️', '🇻🇨',
         '🇻🇬', '🇱🇮', '🇨🇨', '🇨🇫', '🇸🇹', '🇬🇱', '🇵🇼', '🇬🇵', '🇭🇲', '🇨🇰', '🇫🇰', '🇵🇳', '🇳🇫', '🇸🇧', '🇹🇱',
         '🇫🇲', '🇮🇴', '🇲🇭', '🇬🇶', '🇹🇰'],
    17: ['🇧🇶', '🇲🇵', '🇨🇽', '🇰🇮', '🇳🇺', '🇸🇯', '🇲🇸', '🇸🇭', '🇹🇻', '🇳🇨', '🇳🇷', '🇧🇱', '🇼🇫', '🇬🇸']
}

# 将 Unicode 序列转换为文件名前缀，同时过滤掉 0xfe0f
def unicode_sequence_to_filename_prefix(unicode_sequence):
    filtered_sequence = [code for code in unicode_sequence if code != 0xfe0f]
    return 'emoji_u' + '_'.join(f'{code:x}' for code in filtered_sequence)

# 定义白名单 Unicode 序列
whitelist_unicode_sequences = [
    [0x1f44b, 0x1f3fb],
    [0x1f64b],
    [0x1f646, 0x200d, 0x2642, 0xfe0f],
    [0x1f466],
    [0x1f469],
    [0x1f469, 0x200d, 0x1f467],
    [0x1f474],
    [0x1f475],
    [0x1f469, 0x200d, 0x1f469, 0x200d, 0x1f466],
    [0x1f468],
    [0x1f385],
    [0x1f468, 0x200d, 0x1f467, 0x200d, 0x1f466],
    [0x1f468, 0x200d, 0x2764, 0xfe0f, 0x200d, 0x1f468],
    [0x1f469, 0x200d, 0x2764, 0xfe0f, 0x200d, 0x1f48b, 0x200d, 0x1f469],
    [0x1f46a],
    [0x1f9d1, 0x200d, 0x1f91d, 0x200d, 0x1f9d1],
    [0x1f469, 0x200d, 0x1f4bb],
    [0x1f3c3, 0x200d, 0x2640, 0xfe0f]
]

# 将 Unicode 序列转换为文件名并添加到白名单中
whitelist_filenames = {
    'emoji_u26f9_1f3ff_200d_2640.bin',
    'emoji_u26f9_1f3ff_200d_2642.bin'
    # 可以添加更多的文件名
}

whitelist_filename_prefixes = {unicode_sequence_to_filename_prefix(seq) + '.bin' for seq in whitelist_unicode_sequences}
WHITELIST = whitelist_filenames.union(whitelist_filename_prefixes)

def is_composite_emoji(filename, underscore_threshold):
    name, extension = os.path.splitext(filename)
    if extension == '.bin':
        underscore_count = name.count('_')
        # 判断下划线的数量是否达到或超过指定阈值
        return underscore_count >= underscore_threshold
    return False

def remove_composite_emojis(directory, level, underscore_threshold):
    total_files = 0
    whitelisted_files = 0
    deleted_files = 0
    remaining_files = 0
    failed_deletions = 0

    # 收集前 level 级的文件名
    level_whitelist = set()
    for lvl in range(0, level + 1):
        if lvl in emoji_levels:
            for emoji in emoji_levels[lvl]:
                unicode_sequence = [ord(char) for char in emoji]
                file_prefix = unicode_sequence_to_filename_prefix(unicode_sequence) + '.bin'
                level_whitelist.add(file_prefix)

    # 合并全局白名单和级别白名单
    global_and_level_whitelist = WHITELIST.union(level_whitelist)

    print(f"Starting directory: {directory}")
    print(f"Underscore threshold: {underscore_threshold}")

    for filename in os.listdir(directory):
        file_path = os.path.join(directory, filename)

        if os.path.isfile(file_path) and filename.endswith('.bin'):
            total_files += 1

            if filename in global_and_level_whitelist:
                whitelisted_files += 1
            elif is_composite_emoji(filename, underscore_threshold):
                print(f"[INFO] Composite emoji to delete: {filename}")
                try:
                    os.remove(file_path)
                    deleted_files += 1
                    print(f"[SUCCESS] Deleted: {filename}")
                except Exception as e:
                    failed_deletions += 1
                    print(f"[ERROR] Unable to delete {filename}: {e}")
            elif is_above_highest_level(filename, level):
                print(f"[INFO] Above level {level} to delete: {filename}")
                try:
                    os.remove(file_path)
                    deleted_files += 1
                    print(f"[SUCCESS] Deleted: {filename}")
                except Exception as e:
                    failed_deletions += 1
                    print(f"[ERROR] Unable to delete {filename}: {e}")
            else:
                remaining_files += 1

    remaining_files = total_files - deleted_files - whitelisted_files + failed_deletions

    print(f"Total .bin files: {total_files}")
    print(f"Whitelisted files: {whitelisted_files}")
    print(f"Deleted files: {deleted_files}")
    print(f"Remaining files: {remaining_files}")
    print(f"Failed deletions: {failed_deletions}")

def is_above_highest_level(filename, level):
    for lvl in range(level + 1, 18):  # 检查高于最高保留级别的文件
        if lvl in emoji_levels:
            for emoji in emoji_levels[lvl]:
                unicode_sequence = [ord(char) for char in emoji]
                file_prefix = unicode_sequence_to_filename_prefix(unicode_sequence) + '.bin'
                if filename == file_prefix:
                    return True
    return False

if __name__ == "__main__":
    script_directory = os.path.dirname(os.path.abspath(__file__))
    emoji_directory = os.path.join(script_directory, 'root', 'font', 'emoji')

    highest_level_to_retain = 9  # 设置你需要保留的最高等级
    underscore_threshold = 3      # 设置用于识别复合 Emoji 文件的 '_' 数量阈值

    print(f"Script is running in directory: {script_directory}")
    print(f"Emoji files are located in directory: {emoji_directory}")

    remove_composite_emojis(emoji_directory, highest_level_to_retain, underscore_threshold)