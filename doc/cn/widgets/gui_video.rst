.. _视频 (Video):

============
视频 (Video)
============

视频控件是用于显示和播放视频的控件。该控件支持多种视频格式，多种数据源（内存、文件系统、FTL 存储），并提供了丰富的播放控制接口。



用法
-----

视频格式
~~~~~~~~~~~~
视频控件支持的视频资源格式有 MJPEG, AVI, H264，各格式特性如下： 

.. table:: 不同视频格式对比
   :widths: 15 17 10 12 16 16 13 17 
   :align: center

   +---------------+-----------------+----------+------------+----------------+----------------+-------------+-----------------+
   |   类型        | 资源大小        | 支持音频 | 支持透明   | 解码时资源消耗 | 支持跳帧       | 帧编码      | 解码器          |
   +===============+=================+==========+============+================+================+=============+=================+
   | `MJPEG`       |  较小           | ❌       | ❌         | 小             | ✔️             | JPEG        | HW(RTL8773G)/SW |
   +---------------+-----------------+----------+------------+----------------+----------------+-------------+-----------------+
   | `AVI`         |  稍大于 MJPEG   | ✔️       | ❌         | 小             | ✔️             | JPEG        | HW(RTL8773G)/SW |
   +---------------+-----------------+----------+------------+----------------+----------------+-------------+-----------------+
   | `H264`        |  极小           | ❌       | ❌         | 较大           | ❌             | H264        | SW              |
   +---------------+-----------------+----------+------------+----------------+----------------+-------------+-----------------+

1. 视频文件资源大小
视频文件的大小受到视频时长、视频帧率、视频分辨率、画面复杂度、是否带音频等多种因素影响。当画面高频内容多，即变化多纹理多时，画面复杂度越高，通常导出视频体积相应越大。
视频文件转换时，可设定合适的质量参数以平衡空间和画质需求。导出的 AVI 格式视频支持 PC 平台常用播放器预览。

2. 视频资源转换
使用转换工具生成 HoneyGUI 可识别接收的视频格式：

  a. 转换工具支持导入常见的视频格式，支持导入图片序列
  b. 不同导出格式的相同质量参数不相对等

详细的视频资源转换制作，详见转换工具说明文档。


访问方式
~~~~~~~~~~~~
视频控件支持多种资源访问方式：

- 直接映射：直接从内存地址读取，如 RAM/PSRAM，NOR Flash XIP。
- 文件系统：通过文件系统接口读取，如 littlefs。
- 缓冲访问：通过存储地址缓冲读取，如 NAND Flash。

视频控件创建时，需根据资源的访问方式调用不同的创建接口。

.. table:: 视频控件创建接口
   :widths: 15 145
   :align: center

   +---------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | 类型          |  创建函数                                                                                                                                     |
   +===============+===============================================================================================================================================+
   | 直接映射      |  :cpp:any:`gui_video_t *gui_video_create_from_mem(void *parent, const char *name, void *addr, int16_t x, int16_t y, int16_t w, int16_t h);`   |
   +---------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | 文件系统      |  :cpp:any:`gui_video_t *gui_video_create_from_fs(void *parent, const char *name, void *addr, int16_t x, int16_t y, int16_t w, int16_t h);`    |
   +---------------+-----------------------------------------------------------------------------------------------------------------------------------------------+
   | 缓冲访问      |  :cpp:any:`gui_video_t *gui_video_create_from_ftl(void *parent, const char *name, void *addr, int16_t x, int16_t y, int16_t w, int16_t h);`   |
   +---------------+-----------------------------------------------------------------------------------------------------------------------------------------------+



播放控制
~~~~~~~~~~~~

播放状态
^^^^^^^^^^^^^^
使用函数 :cpp:any:`void gui_video_set_state(gui_video_t *this, GUI_VIDEO_STATE state);` 来设置视频播放状态，支持设置的状态有播放( :cpp:any:`GUI_VIDEO_STATE_PLAYING`)、
暂停( :cpp:any:`GUI_VIDEO_STATE_PAUSE`)、停止( :cpp:any:`GUI_VIDEO_STATE_STOP`)。
在视频控件处于停止状态( :cpp:any:`GUI_VIDEO_STATE_STOP`)时设置播放( :cpp:any:`GUI_VIDEO_STATE_PLAYING`)视频，视频将从第一帧开始重播。


重复播放
^^^^^^^^^^^^^^
使用函数 :cpp:any:`void gui_video_set_repeat_count(gui_video_t *this, int32_t cnt);` 来设置视频的重复播放次数，设置重复次数为 1 时，视频将播放 2 次。
通过设置重复次数为  :cpp:any:`GUI_VIDEO_REPEAT_INFINITE` 或负数使视频无限循环播放。


帧率设置
^^^^^^^^^^^^^^
视频控件使用资源文件中的帧率作为初始播放帧率，MJPEG 文件中不包含帧率信息，使用默认 25 fps，AVI 和 H264 中均包含有帧率信息。
使用函数  :cpp:any:`void gui_video_set_frame_rate(gui_video_t *this, float fps);` 来设置视频的播放帧率，将会覆盖视频原有的帧率设置。

使用函数  :cpp:any:`uint32_t gui_video_get_frame_time(gui_video_t *this);` 来获取实际设置的帧播放间隔时间。


步进设置
^^^^^^^^^^^^^^
对支持跳帧播放的视频格式，使用函数  :cpp:any:`void gui_video_set_frame_step(gui_video_t *this, uint32_t step);` 设置视频帧的播放步进，以实现快进的播放效果，不支持倒放。
使用函数  :cpp:any:`uint32_t gui_video_get_frame_step(gui_video_t *this);` 来获取当前视频控件的播放步进。



UI 变换
~~~~~~~~~~~~
缩放
^^^^^^^^^^^^^^
使用函数   :cpp:any:`void gui_video_set_scale(gui_video_t *this, float scale_x, float scale_y);` 来设置视频画面的缩放参数，
调节视频画面比例。



示例
---------
以下代码段示例了如何创建视频控件，设置播放帧率，控制播放，以及如何注册交互事件，并设置播放速度。


.. literalinclude:: ../../../example/widget/video/example_video.c
    :language: c
    :start-after: /* gui video widget example start*/
    :end-before: /* gui video widget example end*/

    

.. raw:: html

   <br>
   <div style="text-align: center"><img src="https://foruda.gitee.com/images/1770019653434266312/5aa9c3c8_9218678.webp" width= "400" /></div>
   <br>


API
------

.. doxygenfile:: gui_video.h









